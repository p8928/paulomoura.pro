---
// src/components/htmx/contact_form/ContactForm.astro
---

<div id="contact-form-container" class="contact-form-container">
  <!-- Logo posicionado no canto da viewport -->
  <div class="contact-form__logo">
    <img src="/img_avif/m_silver.avif" alt="Logo Moura" width="40" height="40">
  </div>
  
  <!-- Botão de fechar posicionado no canto da viewport -->
  <button class="contact-form__close-btn" onclick="closeForm()" aria-label="Fechar formulário">
    <span class="contact-form__close-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </span>
  </button>

  <div class="contact-form-layout">
    <!-- Conteúdo do formulário -->
    <div class="contact-form__content">
      <div class="contact-form__header">
        <h2 class="contact-form__title">Vamos conversar sobre o seu projeto</h2>
        <p class="contact-form__subtitle">Preencha os campos abaixo para iniciarmos.</p>
      </div>

      <form id="contactForm" class="contact-form__form-grid">
        <!-- Coluna da Esquerda -->
        <div class="form-column">
          <div class="input-group">
            <label for="nome" class="form-label">Nome Completo</label>
            <input type="text" id="nome" name="nome" class="form-input" placeholder="Seu nome" required>
          </div>
          <div class="input-group">
            <label for="cargo" class="form-label">Seu Cargo</label>
            <select id="cargo" name="cargo" class="form-select" required>
              <option value="" disabled selected>Selecione seu cargo</option>
              <option value="dono">Dono(a)</option>
              <option value="diretor">Diretor(a)</option>
              <option value="gerente">Gerente</option>
              <option value="outro">Outro</option>
            </select>
          </div>
          <div class="input-group">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" name="email" class="form-input" placeholder="seu@email.com" required>
          </div>
          <div class="input-group">
            <label for="telefone" class="form-label">Telefone</label>
            <input type="tel" id="telefone" name="telefone" class="form-input" placeholder="(11) 99999-9999" required>
          </div>
        </div>

        <!-- Coluna da Direita -->
        <div class="form-column">
          <div class="input-group">
            <label for="empresa" class="form-label">Nome da Empresa</label>
            <input type="text" id="empresa" name="empresa" class="form-input" placeholder="Nome da sua empresa" required>
          </div>
          <div class="input-group">
            <label for="website" class="form-label">Website</label>
            <input type="url" id="website" name="website" class="form-input" placeholder="https://suaempresa.com.br">
            <div class="checkbox-container" onclick="toggleCheckbox('noWebsite')">
              <div class="checkbox" id="noWebsiteCheck"></div>
              <span class="checkbox-label">Minha empresa não tem site</span>
            </div>
          </div>
          <div class="input-group">
            <label for="orcamento" class="form-label">Orçamento Anual de Marketing</label>
            <select id="orcamento" name="orcamento" class="form-select" required>
              <option value="" disabled selected>Selecione o orçamento</option>
              <option value="ate-10k">Até R$ 10.000</option>
              <option value="10k-50k">R$ 10.001 a R$ 50.000</option>
              <option value="50k-100k">R$ 50.001 a R$ 100.000</option>
              <option value="100k-500k">R$ 100.001 a R$ 500.000</option>
              <option value="500k+">Mais de R$ 500.000</option>
              <option value="nao-definido">Ainda não definimos</option>
            </select>
          </div>

        </div>

        <!-- Seção de Consentimento e Envio -->
        <div class="form-full-width">
          <div class="consent-section">
            <div class="checkbox-container" onclick="toggleCheckbox('emailConsent')">
              <div class="checkbox" id="emailConsentCheck"></div>
              <span class="checkbox-label">Desejo receber comunicações da Moura via email.</span>
            </div>
            <p class="consent-text">
              Ao enviar, você concorda com nossa <a href="/politica-de-privacidade" class="consent-link">Política de Privacidade</a>.
            </p>
          </div>
          <button type="submit" class="btn btn-primary" id="submitBtn">Enviar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tela de Sucesso -->
  <div id="success-message" class="success-message-container hidden">
    <div class="success-message__content">
      <h2 class="success-message__title">Obrigado!</h2>
      <p class="success-message__text">Sua mensagem foi enviada. Entraremos em contato em breve.</p>
      <button class="btn btn-secondary" onclick="closeForm()">Fechar</button>
    </div>
  </div>
</div>

<style>
  :root {
    /* Cores */
    --color-background: #0D0D0D;
    --color-surface: #1A1A1A;
    --color-primary: #FFFFFF;
    --color-secondary: #A0A0A0;
    --color-accent: #C0B283;
    --color-border: #333333;
    --color-error: #FF6B6B;

    /* Tipografia */
    --font-family-sans: 'Helvetica Neue', sans-serif;
    --font-family-heading: 'Neue Haas Grotesk', sans-serif;
    --font-size-base: 16px;
    --font-weight-regular: 400;
    --font-weight-medium: 500;
    --font-weight-bold: 700;

    /* Espaçamento */
    --space-xs: 4px;
    --space-sm: 8px;
    --space-md: 16px;
    --space-lg: 24px;
    --space-xl: 32px;

    /* Bordas */
    --radius-md: 8px;
    --radius-sm: 4px;

    /* Transições */
    --transition-fast: 200ms ease-in-out;
  }

  .contact-form-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    animation: fadeIn 0.3s forwards;
  }

  @keyframes fadeIn {
    to { opacity: 1; }
  }

  @keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  .contact-form-layout {
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    width: 90%;
    max-width: 900px;
    max-height: 85vh; /* Reduced max-height to provide more space */
    overflow-y: auto;
    position: relative;
    padding: var(--space-lg); /* Reduced padding to save space */
    transform: scale(0.95);
    animation: scaleIn 0.3s forwards;
  }

  @keyframes scaleIn {
    to { transform: scale(1); }
  }
  
  @media (max-width: 768px) {
    .contact-form-layout {
      padding: var(--space-md); /* Further reduced padding on mobile */
      max-height: 90vh;
    }

    .contact-form__title {
      font-size: 1.5rem;
    }
  }

  @media (min-width: 768px) {
    .contact-form-layout {
      max-height: 80vh; /* Reduced max-height to provide more space */
      padding: var(--space-lg);
    }
  }

  .contact-form__content {
    margin-top: 30px; /* Reduced margin to save space */
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .contact-form__form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-md); /* Reduced gap to save space */
    flex-grow: 1;
    overflow: hidden;
  }

  @media (min-width: 768px) {
    .contact-form__form-grid {
      grid-template-columns: 1fr 1fr;
    }
    .form-full-width {
      grid-column: 1 / -1;
    }
  }

  .input-group {
    margin-bottom: var(--space-sm); /* Reduced bottom margin */
  }

  .form-input,
  .form-select {
    padding: 8px 12px; /* Reduced padding to save space */
    font-size: 0.9rem; /* Slightly smaller font */
  }

  .btn {
    padding: 10px var(--space-md); /* Reduced padding on buttons */
    font-size: 0.95rem; /* Slightly smaller font */
  }

  .contact-form__logo {
    position: fixed;
    top: var(--space-lg);
    left: var(--space-lg);
    z-index: 10001;
  }

  .contact-form__close-btn {
    position: fixed;
    top: var(--space-lg);
    right: var(--space-lg);
    background: transparent;
    border: none;
    cursor: pointer;
    width: var(--size-icon-lg);
    height: var(--size-icon-lg);
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-full);
    transition: all var(--transition-normal);
  }

  .contact-form__close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: rotate(90deg);
  }

  .contact-form__close-icon {
    width: var(--size-icon-sm);
    height: var(--size-icon-sm);
    color: var(--color-primary);
    transition: color var(--transition-normal);
  }

  .contact-form__close-btn:hover .contact-form__close-icon {
    color: var(--color-accent);
  }

  .contact-form__content {
    margin-top: 40px;
  }

  .contact-form__header {
    text-align: center;
    margin-bottom: var(--space-lg);
  }

  .contact-form__title {
    font-family: var(--font-family-heading);
    font-size: 1.8rem;
    font-weight: var(--font-weight-medium);
    color: var(--color-primary);
    margin: 0 0 var(--space-sm) 0;
  }

  .contact-form__subtitle {
    font-size: 1rem;
    color: var(--color-secondary);
    margin: 0;
  }

  .contact-form__form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg);
  }

  @media (min-width: 768px) {
    .contact-form__form-grid {
      grid-template-columns: 1fr 1fr;
    }
    .form-full-width {
      grid-column: 1 / -1;
    }
  }

  .input-group {
    margin-bottom: var(--space-md);
  }

  .form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium);
    color: var(--color-secondary);
    margin-bottom: var(--space-sm);
  }

  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: 12px;
    font-size: 1rem;
    color: var(--color-primary);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
  }

  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px rgba(192, 178, 131, 0.3);
  }

  .form-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23A0A0A0' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 12px;
  }
  
  .form-textarea {
    resize: vertical;
    min-height: 100px;
  }

  .checkbox-container {
    display: flex;
    align-items: center;
    margin-top: var(--space-sm);
    cursor: pointer;
    user-select: none;
  }

  .checkbox {
    width: 18px;
    height: 18px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    margin-right: var(--space-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color var(--transition-fast), border-color var(--transition-fast);
  }

  .checkbox.checked {
    background-color: var(--color-accent);
    border-color: var(--color-accent);
  }

  .checkbox.checked::after {
    content: '✓';
    color: var(--color-background);
    font-size: 12px;
    font-weight: bold;
  }

  .checkbox-label {
    font-size: 0.875rem;
    color: var(--color-secondary);
  }

  .consent-section {
    margin-bottom: var(--space-md);
  }

  .consent-text {
    font-size: 0.8rem;
    color: var(--color-secondary);
    margin-top: var(--space-sm);
  }

  .consent-link {
    color: var(--color-accent);
    text-decoration: none;
  }
  .consent-link:hover {
    text-decoration: underline;
  }

  .btn {
    padding: 12px var(--space-lg);
    border-radius: var(--radius-sm);
    font-size: 1rem;
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: all var(--transition-fast);
    border: 1px solid transparent;
    width: 100%;
  }

  .btn-primary {
    background-color: var(--color-accent);
    color: var(--color-background);
    border-color: var(--color-accent);
  }
  .btn-primary:hover {
    background-color: #d4c59a;
    border-color: #d4c59a;
  }

  .btn-secondary {
    background-color: var(--color-surface);
    color: var(--color-primary);
    border-color: var(--color-border);
  }
  .btn-secondary:hover {
    border-color: var(--color-secondary);
  }

  .hidden {
    display: none !important;
  }

  .success-message-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--color-background);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: var(--space-xl);
    opacity: 0;
    animation: fadeIn 0.3s forwards;
  }

  .success-message__title {
    font-family: var(--font-family-heading);
    font-size: 2rem;
    color: var(--color-primary);
    margin-bottom: var(--space-md);
  }

  .success-message__text {
    font-size: 1rem;
    color: var(--color-secondary);
    margin-bottom: var(--space-lg);
  }
</style>

<script is:inline>
  const formData = {};

  function closeForm() {
    const formContainer = document.getElementById('contact-form-container');
    formContainer.style.animation = 'fadeOut 0.3s forwards';
    
    // Set a timeout to remove the element after the animation completes
    setTimeout(() => {
      formContainer.style.display = 'none';
      formContainer.remove();
    }, 300);
  }

  function toggleCheckbox(checkboxId) {
    const checkbox = document.getElementById(checkboxId + 'Check');
    checkbox.classList.toggle('checked');
    
    if (checkboxId === 'noWebsite') {
      const websiteInput = document.getElementById('website');
      const isChecked = checkbox.classList.contains('checked');
      websiteInput.disabled = isChecked;
      websiteInput.style.opacity = isChecked ? '0.5' : '1';
      if (isChecked) {
        websiteInput.value = '';
      }
    }
  }

  document.getElementById('contactForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Enviando...';

    // Collect form data
    const form = event.target;
    const data = new FormData(form);
    const formDataObject = {};
    data.forEach((value, key) => {
      formDataObject[key] = value;
    });
    
    // Add checkbox data
    formDataObject.noWebsite = document.getElementById('noWebsiteCheck').classList.contains('checked');
    formDataObject.emailConsent = document.getElementById('emailConsentCheck').classList.contains('checked');

    console.log('Form data to submit:', formDataObject);

    fetch('https://formspree.io/f/manpyjqj', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify(formDataObject)
    })
    .then(response => {
      if (response.ok) {
        document.querySelector('.contact-form-layout').classList.add('hidden');
        document.getElementById('success-message').classList.remove('hidden');
      } else {
        response.json().then(data => {
          alert(data.errors ? data.errors.map(e => e.message).join(', ') : 'Ocorreu um erro.');
        });
        submitBtn.disabled = false;
        submitBtn.textContent = 'Enviar';
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Ocorreu um erro de rede. Tente novamente.');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Enviar';
    });
  });
</script>