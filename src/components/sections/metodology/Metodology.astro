---
import './css/metodology.css';
---

<header class="metodology-hero snap-section">
  <div class="metodology-header">
    <h1 class="metodology-title">
      <span class="title-brand">Brand</span>
      <div class="title-dash-container">
        <div class="title-dash"></div>
      </div>
      <span class="title-led">Driven</span>
    </h1>
  </div>
</header>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  let ctx;

  function initAnimations() {
    // If a context from a previous run exists, kill it
    if (ctx) {
      ctx.revert();
    }

    // Create a new GSAP context
    ctx = gsap.context(() => {
      // Title animation timeline
      const tl = gsap.timeline({ delay: 0.2 });
      tl.fromTo(".title-brand", { x: -50, opacity: 0 }, { x: 0, opacity: 1, duration: 1, ease: "power3.out" })
        .fromTo(".title-led", { x: 50, opacity: 0 }, { x: 0, opacity: 1, duration: 1, ease: "power3.out" }, "-=0.8")
        .fromTo(".title-dash", { scaleX: 0, transformOrigin: "center" }, { scaleX: 1, duration: 0.8, ease: "power3.inOut" }, "-=0.8");

      // Parallax animations for shapes
      gsap.to(".shape-1", {
        y: -150,
        ease: "none",
        scrollTrigger: {
          trigger: ".metodology-main-content",
          start: "top bottom",
          end: "bottom top",
          scrub: 0.4,
        },
      });

      gsap.to(".shape-2", {
        y: 200,
        ease: "none",
        scrollTrigger: {
          trigger: ".metodology-main-content",
          start: "top bottom",
          end: "bottom top",
          scrub: 0.6,
        },
      });

      // Fade-in animations for text elements
      document.querySelectorAll(".animate-fade-in").forEach(el => {
        gsap.fromTo(el, { opacity: 0, y: 30 }, {
          opacity: 1,
          y: 0,
          duration: 1,
          ease: "power3.out",
          scrollTrigger: {
            trigger: el,
            start: "top 85%",
            toggleActions: "play none none none",
          }
        });
      });

      // Animation for the pull quote
      const blockquote = document.querySelector('.animate-pull-quote');
      if (blockquote) {
        gsap.from(blockquote, {
          opacity: 0,
          scale: 0.95,
          duration: 1.2,
          ease: "power4.out",
          scrollTrigger: {
            trigger: blockquote,
            start: "top 80%",
            toggleActions: "play none none none",
          }
        });
      }
    });
  }

  // Run animations on initial page load and subsequent Astro navigations
  document.addEventListener('astro:page-load', initAnimations);
  
  // Clean up the GSAP context before the page is swapped
  document.addEventListener('astro:before-swap', () => {
    if (ctx) {
      ctx.revert();
    }
  });
</script>
