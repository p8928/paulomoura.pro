---
import './css/nav_bar.css';
import 'flag-icons/css/flag-icons.min.css';
---
  
  <header class="hero__header">
    <div class="hero__logo">
      <img src="/img/m_black.png" alt="Logo Moura">
    </div>
    <nav class="hero__nav">
      <!-- Language selector -->
      <div class="hero__language-selector">
        <button class="hero__language-btn" id="languageBtn" aria-label="Selecionar idioma">
          <span id="currentLanguage">pt-BR</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 4px;">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        
        <div class="hero__language-dropdown" id="languageDropdown">
          <a href="#" class="hero__language-option" data-lang="pt" data-text="pt-BR">
            <span class="fi fi-br"></span>
            <span>Português</span>
          </a>
          <a href="#" class="hero__language-option" data-lang="en" data-text="en-UK">
            <span class="fi fi-gb"></span>
            <span>English</span>
          </a>
          <a href="#" class="hero__language-option" data-lang="es" data-text="es-ES">
            <span class="fi fi-es"></span>
            <span>Español</span>
          </a>
        </div>
      </div>
      
      <a href="/blog" class="hero__nav-link hover-underline blog-link">BLOG</a>
      
      <a href="/contato" 
         class="hero__nav-link hover-underline contact">
        CONTATO
      </a>
      
      <button class="hero__menu-btn" id="openMenu">
        MENU
        <span class="hero__menu-lines">
          <span></span>
        </span>
      </button>
    </nav>
  </header>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
      const languageBtn = document.getElementById('languageBtn');
      const languageDropdown = document.getElementById('languageDropdown');
      const currentLanguage = document.getElementById('currentLanguage');
      const languageOptions = document.querySelectorAll('.hero__language-option');
      
      // Initialize with Portuguese as default
      const defaultLanguage = 'pt';
      
      // Set initial language from localStorage or default
      const savedLanguage = localStorage.getItem('selectedLanguage') || defaultLanguage;
      
      // Set active language on page load
      setActiveLanguage(savedLanguage);
      
      // Add click event to language button to toggle dropdown
      languageBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        languageDropdown.classList.toggle('show');
      });
      
      // Close dropdown when clicking outside or pressing ESC
      document.addEventListener('click', function(e) {
        if (!languageBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
          closeDropdown();
        }
      });
      
      // Close dropdown on ESC key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeDropdown();
        }
      });
      
      // Handle language selection
      languageOptions.forEach(option => {
        option.addEventListener('click', function(e) {
          e.preventDefault();
          const lang = this.getAttribute('data-lang');
          setActiveLanguage(lang);
          closeDropdown();
        });
      });
      
      // Set active language
      function setActiveLanguage(lang) {
        const selectedOption = document.querySelector(`.hero__language-option[data-lang="${lang}"]`);
        if (selectedOption) {
          const text = selectedOption.getAttribute('data-text');
          
          // Update current language display
          currentLanguage.textContent = text;
          
          // Update active state
          languageOptions.forEach(option => {
            option.classList.toggle('active', option.getAttribute('data-lang') === lang);
          });
          
          // Save to localStorage
          localStorage.setItem('selectedLanguage', lang);
          localStorage.setItem('userLanguage', lang);
        }
      }
      
      function closeDropdown() {
        languageDropdown.classList.remove('show');
      }
    });
  </script>
